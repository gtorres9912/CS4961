<% 
  require 'osk_config' 
  require 'osk_global' 
  
  @APP_PREFIX_STR    = "SCSIM"
  @HK_TLM_MID_STR    = "SCSIM_HK_TLM_MID"
  @MGMT_TLM_MID_STR  = "SCSIM_MGMT_TLM_MID"
  @MODEL_TLM_MID_STR = "SCSIM_MODEL_TLM_MID"
%>

TELEMETRY SCSIM HK_TLM_PKT <%= Osk::Cfg.processor_endian %> "ScSim App"
  <%= Osk::Cfg.tlm_hdr(@APP_PREFIX_STR, @HK_TLM_MID_STR) %>

  APPEND_ITEM <%= Osk::TLM_STR_CMD_VLD %> 16 UINT  "Count of valid commands received since startup or the last reset counter command"
  APPEND_ITEM <%= Osk::TLM_STR_CMD_ERR %> 16 UINT  "Count of invalid commands received since startup or the last reset counter command"

  APPEND_ITEM LAST_TBL_ACTION  8 UINT  "Last table action: 1=Register, 2=Load, 3=Dump"
    STATE REGISTER 1
    STATE LOAD     2
    STATE DUMP     3

  APPEND_ITEM LAST_TBL_STATUS  8 UINT  "Last table action status: 0=Undefined, 1=Invalid, 2=Valid"
    STATE VALID   1
    STATE INVALID 2

  APPEND_ITEM SIM_ACTIVE 8 UINT  ""
    STATE FALSE   0
    STATE TRUE    1  GREEN

  APPEND_ITEM SIM_PHASE 8 UINT  ""
    STATE INIT         1
    STATE TIME_LAPSE1  2
    STATE TIME_LAPSE2  3
    STATE REALTIME     4

  APPEND_ITEM SIM_TIME 32 INT  ""


TELEMETRY SCSIM MGMT_TLM_PKT <%= Osk::Cfg.processor_endian %> "ScSim Management"
  <%= Osk::Cfg.tlm_hdr(@APP_PREFIX_STR, @MGMT_TLM_MID_STR) %>
  
  APPEND_ITEM SIM_TIME 32 INT  ""

  APPEND_ITEM SIM_ACTIVE 8 UINT  ""
    STATE FALSE   0
    STATE TRUE    1  GREEN

  APPEND_ITEM SIM_PHASE 8 UINT  ""
    STATE IDLE         1
    STATE INIT         2
    STATE TIME_LAPSE1  3
    STATE TIME_LAPSE2  4
    STATE REALTIME     5

  APPEND_ITEM CONTACT_TIME_PENDING    16 INT  ""  # Negative time indicates no contact scheduled
  APPEND_ITEM CONTACT_LENGTH          16 UINT  ""
  APPEND_ITEM CONTACT_TIME_CONSUMED   16 UINT  ""
  APPEND_ITEM CONTACT_TIME_REMAINING  16 UINT  ""


  APPEND_ITEM LAST_EVT_SUBSYS   8 UINT  ""
    STATE SIM   1
    STATE ADCS  2
    STATE CDH   3
    STATE COMM  4
    STATE PWR   5
    STATE THRM  6
  APPEND_ITEM LAST_EVT_CMD_ID   8 UINT  ""

  APPEND_ITEM NEXT_EVT_SUBSYS   8 UINT  ""
    STATE SIM   1
    STATE ADCS  2
    STATE CDH   3
    STATE COMM  4
    STATE PWR   5
    STATE THRM  6
  APPEND_ITEM NEXT_EVT_CMD_ID   8 UINT  ""

  APPEND_ITEM ADCS_LAST_EVT_TIME   32 INT   ""
  APPEND_ITEM ADCS_LAST_EVT_CMD_ID 32 UINT  ""
    STATE SET_MODE       1
    STATE ENTER_ECLIPSE  2
    STATE EXIT_ECLIPSE   3
    STATE SET_ATTITUDE   4
    STATE SET_ORBIT      5
   
  APPEND_ITEM CDH_LAST_EVT_TIME   32 INT   ""
  APPEND_ITEM CDH_LAST_EVT_CMD_ID 32 UINT  ""

  APPEND_ITEM COMM_LAST_EVT_TIME   32 INT   ""
  APPEND_ITEM COMM_LAST_EVT_CMD_ID 32 UINT  ""
    STATE SCH_AOS       1
    STATE ABORT_CONTACT 2
   
  APPEND_ITEM PWR_LAST_EVT_TIME   32 INT   ""
  APPEND_ITEM PWR_LAST_EVT_CMD_ID 32 UINT  ""

  APPEND_ITEM THRM_LAST_EVT_TIME   32 INT   ""
  APPEND_ITEM THRM_LAST_EVT_CMD_ID 32 UINT  ""


TELEMETRY SCSIM MODEL_TLM_PKT <%= Osk::Cfg.processor_endian %> "ScSim Model States"
  <%= Osk::Cfg.tlm_hdr(@APP_PREFIX_STR, @MODEL_TLM_MID_STR) %>
  
  # ADCS
  APPEND_ITEM ECLIPSE     8 UINT  ""
    STATE  FALSE 0 
    STATE  TRUE  1
    
  APPEND_ITEM ADCS_MODE   8 UINT  ""
    STATE  SAFEHOLD   1
    STATE  SUN_POINT  2
    STATE  INERTIAL   3
    STATE  SLEW       4

  # C&DH
  
  APPEND_ITEM SBC_RST_CNT  16 UINT  ""
  APPEND_ITEM HW_CMD_CNT   16 UINT  ""
  APPEND_ITEM LAST_HW_CMD  16 UINT  ""

  # Comm

  APPEND_ITEM IN_CONTACT              16 UINT  ""
  APPEND_ITEM CONTACT_TIME_PENDING    16 UINT  ""
  APPEND_ITEM CONTACT_TIME_CONSUMED   16 UINT  ""
  APPEND_ITEM CONTACT_TIME_REMAINING  16 UINT  ""
  APPEND_ITEM CONTACT_LINK             8 UINT  ""
    STATE  UNDEF   0
    STATE  DUPLEX  1
    STATE  SIMPLEX 2
  APPEND_ITEM CONTACT_TDRS_ID          8 UINT  ""
    STATE  UNDEF    0
    STATE  ATLANTIC 1
    STATE  INDIAN   2
    STATE  PACIFIC  3
  APPEND_ITEM CONTACT_DATA_RATE       16 UINT  ""
   
  # FSW
  
  APPEND_ITEM REC_PCT_USED 32 FLOAT "Percentage"
    FORMAT_STRING "%.2f"
  APPEND_ITEM REC_FILE_CNT 16 UINT  ""
  APPEND_ITEM REC_PLBK_ENA 8 UINT  ""
    STATE  FALSE 0 
    STATE  TRUE  1
  APPEND_ITEM FSW_SPARE 8 UINT  ""

  # Instrument

  APPEND_ITEM INSTR_PWR   8 UINT  ""
    STATE  OFF 0 
    STATE  ON  1
    
  APPEND_ITEM INSTR_SCI   8 UINT  ""
    STATE  OFF 0 
    STATE  ON  1

  APPEND_ITEM INSTR_FILE_CNT     16 UINT  ""
  APPEND_ITEM INSTR_FILE_CYC_CNT 16 UINT  ""

  # Power
  
  APPEND_ITEM BATT_SOC   32 FLOAT "Percentage"
    FORMAT_STRING "%.2f"  
  APPEND_ITEM SA_CURRENT 32 FLOAT "Solar Array current (amps)"
    FORMAT_STRING "%.2f"
    
  # Thermal

  APPEND_ITEM HEATER_1   8 UINT  ""
    STATE  OFF 0 
    STATE  ON  1
    
  APPEND_ITEM HEATER_2   8 UINT  ""
    STATE  OFF 0 
    STATE  ON  1
        